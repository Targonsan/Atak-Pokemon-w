#include <iostream>
#include <conio.h>
#include <string>
#include <stdlib.h>
#include <cstdlib>
#include <windows.h>
#include <cstdlib>
#include <ctime>
using namespace std;
static const int n = 20;
static const int m = 40;
int macierz[n][m];
int poziomUlepszen=0;
unsigned char znak;
int start = 0;
HANDLE hOut;
 
struct Position
{
    int x;
    int y;
};
 
/************************************************************/
class mapa
{
        int xmax,ymax;
    public:
        void czyszczenie_mapy();
        void rysowanie_mapy();
        void zerowanie_macierzy();
        void losowanie();
        void budowanie_scian();
        mapa(int a,int b); 
};
 
void mapa::czyszczenie_mapy()
{
  HANDLE                     hStdOut;
  CONSOLE_SCREEN_BUFFER_INFO csbi;
  DWORD                      count;
  DWORD                      cellCount;
  COORD                      homeCoords = { 0, 0 };
 
  hStdOut = GetStdHandle( STD_OUTPUT_HANDLE );
  if (hStdOut == INVALID_HANDLE_VALUE) return;
 
  /* Get the number of cells in the current buffer */
  if (!GetConsoleScreenBufferInfo( hStdOut, &csbi )) return;
  cellCount = csbi.dwSize.X *csbi.dwSize.Y;
 
  /* Fill the entire buffer with spaces */
  if (!FillConsoleOutputCharacter(
    hStdOut,
    (TCHAR) ' ',
    cellCount,
    homeCoords,
    &count
    )) return;
 
  /* Fill the entire buffer with the current colors and attributes */
  if (!FillConsoleOutputAttribute(
    hStdOut,
    csbi.wAttributes,
    cellCount,
    homeCoords,
    &count
    )) return;
  /* Move the cursor home */
  SetConsoleCursorPosition( hStdOut, homeCoords );
   
}
 
void mapa::rysowanie_mapy()
{
    hOut = GetStdHandle( STD_OUTPUT_HANDLE );
    for(int i = 0; i<n; i++)
        {
            for (int j = 0; j<m; j++)
            {
                    if(macierz[i][j] == 7)
                    {
                        SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_INTENSITY );
                        cout << "#";
                        SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );
                    }
                   
                    else if(macierz[i][j] == 2)
                    {
                        SetConsoleTextAttribute( hOut, FOREGROUND_BLUE | FOREGROUND_RED | FOREGROUND_INTENSITY );
                        cout << "G";
                        SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );
                    }
               
                    else if (macierz[i][j] == 3)
                    {
                        SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_RED | FOREGROUND_INTENSITY );
                        cout << "Q";// Tu bedzie dzialo
                        SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );
                    }
 
                    // Fortyfikacje                
                    else if (macierz[i][j] == 4)
                    {
 
                        if(poziomUlepszen == 0)
                        {
                            SetConsoleTextAttribute( hOut, FOREGROUND_BLUE | FOREGROUND_INTENSITY );
                            cout << "X";
                            SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );
                        }
                        else if(poziomUlepszen == 1)
                        {
                            SetConsoleTextAttribute( hOut, FOREGROUND_RED | FOREGROUND_INTENSITY );
                            cout << "X";
                            SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );                          
                        }
                        else if(poziomUlepszen == 2)
                        {
                            SetConsoleTextAttribute( hOut, FOREGROUND_BLUE | FOREGROUND_GREEN | FOREGROUND_INTENSITY );
                            cout << "X";
                            SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );                          
                        }
                        else
                        {
                            SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_RED | FOREGROUND_INTENSITY );
                            cout << "X";
                            SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );
                            poziomUlepszen = 0; // testowo                        
                        }
                    }
                   
                    // Fortyfikacje lvl 2          
                    else if (macierz[i][j] == 5)
                    {
                        cout << "X";
                        SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );
                    }
                   
                    // Fortyfikacje lvl 3              
                    else if (macierz[i][j] == 6)
                    {
                        SetConsoleTextAttribute( hOut, FOREGROUND_RED | FOREGROUND_INTENSITY );
                        cout << "X";
                        SetConsoleTextAttribute( hOut, FOREGROUND_GREEN | FOREGROUND_BLUE | FOREGROUND_RED );
                    }
                   
                    else
                    {
                        cout << " ";
                    }
            }
            cout << endl;
        }
}
 
void mapa::zerowanie_macierzy()
{
      // zerowanie macierzy
    for(int i = 0; i<xmax; i++)
    {
        for (int j = 0; j<ymax; j++)
        {
                macierz[i][j] = 0;
        }
    }
}
 
void mapa::budowanie_scian()
{
      // Budowanie scian
    for(int i = 0; i<n; i++)
    {
        for (int j = 0; j<m; j++)
        {
                macierz[i][0] = 7;
                macierz[i][m-1] = 7;
                macierz[0][j] = 7;
                macierz[n-1][j] = 7;
        }
    }
}
 
void mapa::losowanie()
{
    cout<<"komputer: "<<endl;
    int a=(( rand() % 2 ) + 0 );
    if(a == 0)
    {
        cout<<"wysłanie zolnierza"<<endl;
    }
    else if(a== 1)
    {
        cout<<"rozbudowa zamku"<<endl;
        poziomUlepszen++;
    }
    else if(a== 2)
    {
        cout<<"ulepszenie dziala"<<endl;
    }
}
 
mapa::mapa(int a,int b)
{
    this->xmax=a;
    this->ymax=b;
   
}
 
/************************************************************/
 
class Object
{
 
    public:
        Position pozycja;
        int getX(); // wyciaganie parametrow
        int getY();
        void setX(int x); // ustawianie parametrow
        void setY(int y);
};
 
int Object::getX()
{
    return pozycja.x;
}
 
int Object::getY()
{
    return pozycja.y;
}
 
void Object::setX(int x)
{
    pozycja.x = x;
}
 
void Object::setY(int y)
{
    pozycja.y = y;
}
/************************************************************/
 
class Pokemen : public Object
{  
    public:
        Pokemen(int x, int y );
        void rysuj(Pokemen p);
        void ruch();
       
};
 
Pokemen::Pokemen(int x, int y)
{
    setX(x);
    setY(y);
}
 
void Pokemen::ruch()
{    
        znak = getch();
        switch( znak )
        {
            case 72: //strzałka w górę
                if(macierz[pozycja.x-1][pozycja.y] <1 )
                {
                   
                    macierz[pozycja.x][pozycja.y] = 0;
                    pozycja.x--;
                    macierz[pozycja.x][pozycja.y] = 2;
                    Beep(400,100);                
                }
 
                break;
            case 80: //strzałka w dół
                if(macierz[pozycja.x+1][pozycja.y] < 1)
                {
                    macierz[pozycja.x][pozycja.y] = 0;
                    pozycja.x++;
                    macierz[pozycja.x][pozycja.y] = 2;
                     Beep(500,100);                    
                }
           
                break;
            case 75: //strzałka w lewo
                if(macierz[pozycja.x][pozycja.y-1] < 1)
                {
                    macierz[pozycja.x][pozycja.y] = 0;
                    pozycja.y--;
                    macierz[pozycja.x][pozycja.y] = 2;
                    Beep(440,100);                
                }
 
                break;
            case 77: //strzałka w prawo
                if(macierz[pozycja.x][pozycja.y+1] < 1)
                {
                    macierz[pozycja.x][pozycja.y] = 0;
                    pozycja.y++;
                    macierz[pozycja.x][pozycja.y] = 2;
                     Beep(600,100);                    
                }
           
                break;
 
            case 27: //ESC
               
                break;
        }  
}
 
void Pokemen::rysuj(Pokemen p)
{
    macierz[p.getX()][p.getY()] = 2;
}
 
class Zamek : public Object
{
    public:
        Zamek(int x, int y );  
};
 
Zamek::Zamek(int x, int y)
{
    setX(x);
    setY(y);
}
 
 
 
 
/************************************************************/
 
 
int main()
{
    srand( time( NULL ) );
    HANDLE hOut;
    hOut = GetStdHandle( STD_OUTPUT_HANDLE );
    int start = 1;
    int x = 3;
    int y = 3;
    int licznik=0;
   
    mapa narnia(n,m);  
    narnia.zerowanie_macierzy();
    narnia.budowanie_scian();
   
    Pokemen gracz(x,y);
    gracz.rysuj(gracz);
   
    // Pozycja dla bazy
    macierz[(n-1)/2][(m-1)/2] = 3;
   
    // Wspolrzedne dla fortyfikacji
    macierz[n/2][(m-1)/2] = 4;
    macierz[n/2][m/2] = 4;
    macierz[n/2][(m/2)-2] = 4;
   
    macierz[(n/2)-1][(m/2)-2] = 4;
    macierz[(n/2)-1][m/2] = 4;
   
    macierz[(n/2)-2][(m-1)/2] = 4;
    macierz[(n/2)-2][m/2] = 4;
    macierz[(n/2)-2][(m/2)-2] = 4;
         
    while(start)
    {
        cout << "<<<<<<<<<<< ATAK POKEMENOW >>>>>>>>>>>>" << endl;
        cout << "Wcisnij ESC aby wyjsc!";
        cout << endl;
        liczba wykonanych ruchów
        losowanie co wybierze komouter
 
 
        narnia.losowanie();
        cout<<"liczba ruchow: " << licznik << endl;
        narnia.rysowanie_mapy();
        gracz.ruch();
       
        narnia.czyszczenie_mapy();
        licznik++;    
    }
   
    cout << endl;
    cout << endl;
    return 0;      
}

